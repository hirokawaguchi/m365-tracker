# Squid設定ファイル - Microsoft 365ホワイトリスト用
# ホワイトリストファイルを定義
acl whitelist_urls dstdomain "/etc/squid/whitelist/whitelist.txt"
acl whitelist_ips dst "/etc/squid/whitelist/whitelist_ips.txt"

# ローカルネットワークを定義
acl localnet src 10.0.0.0/8
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16
acl localnet src fc00::/7
acl localnet src fe80::/10

# 安全なポートを定義
acl Safe_ports port 80
acl Safe_ports port 443
acl Safe_ports port 993
acl Safe_ports port 995

# SSLポート
acl SSL_ports port 443

# HTTPSメソッドを許可
acl CONNECT method CONNECT

# アクセス制御ルール
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# ホワイトリストに基づいてアクセスを許可
http_access allow localnet whitelist_urls
http_access allow localnet whitelist_ips

# その他のアクセスを拒否
http_access deny all

# HTTPポート
http_port 3128

# キャッシュディレクトリ (無効化してシンプルに)
# cache_dir ufs /var/spool/squid 100 16 256
cache deny all

# メモリキャッシュ
cache_mem 256 MB

# ログ設定
access_log daemon:/var/log/squid/access.log squid
cache_log /var/log/squid/cache.log

# PIDファイル
pid_filename /var/run/squid/squid.pid

# コア設定
coredump_dir /var/spool/squid

# リフレッシュパターン
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320
